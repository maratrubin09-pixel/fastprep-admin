# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –¥–ª—è S3 Bucket

–ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ "Network error: Failed to connect to S3. This might be a CORS issue", –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –¥–ª—è –≤–∞—à–µ–≥–æ S3 bucket.

## üîç –ì–¥–µ –∏—Å–∫–∞—Ç—å CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?

### 1. AWS S3

**–ü—É—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [AWS Console](https://console.aws.amazon.com/s3/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à bucket (–∏–º—è —É–∫–∞–∑–∞–Ω–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `S3_BUCKET`)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Permissions"** (–†–∞–∑—Ä–µ—à–µ–Ω–∏—è)
4. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –¥–æ —Å–µ–∫—Ü–∏–∏ **"Cross-origin resource sharing (CORS)"**
5. –ù–∞–∂–º–∏—Ç–µ **"Edit"** (–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)

**–°–∫—Ä–∏–Ω—à–æ—Ç –ø—É—Ç–∏:** `AWS Console ‚Üí S3 ‚Üí [–≤–∞—à bucket] ‚Üí Permissions ‚Üí CORS`

---

### 2. DigitalOcean Spaces

**–ü—É—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [DigitalOcean Control Panel](https://cloud.digitalocean.com/spaces)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à Space (—ç—Ç–æ –∏ –µ—Å—Ç—å –≤–∞—à bucket)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Settings"** (–ù–∞—Å—Ç—Ä–æ–π–∫–∏)
4. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"CORS Configurations"**
5. –ù–∞–∂–º–∏—Ç–µ **"Edit CORS Configurations"**

**–°–∫—Ä–∏–Ω—à–æ—Ç –ø—É—Ç–∏:** `DigitalOcean ‚Üí Spaces ‚Üí [–≤–∞—à space] ‚Üí Settings ‚Üí CORS Configurations`

---

### 3. Cloudflare R2

**–ü—É—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **R2** –≤ –±–æ–∫–æ–≤–æ–º –º–µ–Ω—é
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à bucket
5. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É **"Settings"**
6. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"CORS Policy"**
7. –ù–∞–∂–º–∏—Ç–µ **"Edit"**

**–°–∫—Ä–∏–Ω—à–æ—Ç –ø—É—Ç–∏:** `Cloudflare Dashboard ‚Üí R2 ‚Üí [–≤–∞—à bucket] ‚Üí Settings ‚Üí CORS Policy`

---

### 4. Backblaze B2

**–ü—É—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [Backblaze Control Panel](https://secure.backblaze.com/b2_buckets.htm)
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à bucket
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏
4. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"CORS Rules"** –∏–ª–∏ **"Lifecycle Settings"**
5. –ù–∞–∂–º–∏—Ç–µ **"Add CORS Rule"** –∏–ª–∏ **"Edit"**

---

### 5. IONOS Object Storage

**–ü—É—Ç—å:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [IONOS Cloud Panel](https://cloud.ionos.com/)
2. –í–æ–π–¥–∏—Ç–µ –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"Storage"** –∏–ª–∏ **"Object Storage"**
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à bucket
5. –ù–∞–π–¥–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É **"Settings"** –∏–ª–∏ **"Configuration"**
6. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"CORS Configuration"** –∏–ª–∏ **"Cross-Origin Resource Sharing"**
7. –ù–∞–∂–º–∏—Ç–µ **"Edit"** –∏–ª–∏ **"Add CORS Rule"**

**–°–∫—Ä–∏–Ω—à–æ—Ç –ø—É—Ç–∏:** `IONOS Cloud ‚Üí Storage/Object Storage ‚Üí [–≤–∞—à bucket] ‚Üí Settings ‚Üí CORS Configuration`

**–í–∞–∂–Ω–æ –¥–ª—è IONOS:**
- Endpoint –æ–±—ã—á–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫: `s3.[region].ionoscloud.com` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `s3.de-central.ionoscloud.com`)
- Region –æ–±—ã—á–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `de-central`, `us-west`, –∏ —Ç.–¥.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–µ–≥–∏–æ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `S3_REGION`

---

### 6. Wasabi / MinIO / –î—Ä—É–≥–∏–µ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ

**–û–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤:**
- Bucket ‚Üí Settings ‚Üí CORS
- Bucket ‚Üí Permissions ‚Üí CORS
- Bucket ‚Üí Security ‚Üí CORS

–ò—â–∏—Ç–µ —Ä–∞–∑–¥–µ–ª—ã: **"CORS"**, **"Cross-Origin Resource Sharing"**, –∏–ª–∏ **"CORS Policy"**

3. **–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é CORS:**

```json
[
    {
        "AllowedOrigins": [
            "https://admin.fastprepusa.com",
            "http://localhost:3000",
            "http://localhost:3001"
        ],
        "AllowedMethods": [
            "PUT",
            "GET",
            "HEAD",
            "POST"
        ],
        "AllowedHeaders": [
            "*"
        ],
        "ExposeHeaders": [
            "ETag",
            "x-amz-request-id",
            "x-amz-id-2"
        ],
        "MaxAgeSeconds": 3000
    }
]
```

4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â (DigitalOcean Spaces, Backblaze B2, etc.)

–î–ª—è S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â –ø—Ä–æ—Ü–µ—Å—Å –ø–æ—Ö–æ–∂, –Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è:

1. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é CORS –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö bucket
2. –î–æ–±–∞–≤—å—Ç–µ —Ç—É –∂–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, —á—Ç–æ —É–∫–∞–∑–∞–Ω–∞ –≤—ã—à–µ
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –¥–æ–º–µ–Ω `admin.fastprepusa.com` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `AllowedOrigins`

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS:
1. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã (–∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –Ω–µ —Å—Ä–∞–∑—É)
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å–Ω–æ–≤–∞
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ CORS

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

- **AllowedOrigins** –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ—á–Ω—ã–π –¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–±–µ–∑ trailing slash)
- –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–±–∞–≤—å—Ç–µ `http://localhost:3000` (–∏–ª–∏ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ)
- **AllowedMethods** –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å `PUT` (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤)
- **AllowedHeaders** –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å `["*"]` –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –∏–ª–∏ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ bucket —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `S3_ENDPOINT`, `S3_BUCKET` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ bucket (bucket policy)
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ —Ç–æ—á–Ω—É—é –æ—à–∏–±–∫—É CORS

---

## –ü–æ–ª—É—á–µ–Ω–∏–µ Access Keys –¥–ª—è DigitalOcean Spaces

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á (–µ—Å–ª–∏ Secret —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω)

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å Access Key (–Ω–∞–ø—Ä–∏–º–µ—Ä, "portal"), –∏ –≤—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ Secret Access Key, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ.

**–í–∞–∂–Ω–æ:** Secret Access Key –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª—é—á–∞. –ï—Å–ª–∏ –≤—ã –µ–≥–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏, –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–ª—é—á.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Access Key

1. **–í DigitalOcean Console:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à Spaces Bucket
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings** ‚Üí **Access Keys**
   - –ù–∞–∂–º–∏—Ç–µ **"Create Access Key"**

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á:**
   - **Access Key Name:** –ù–∞–ø—Ä–∏–º–µ—Ä, `fastprep-admin` –∏–ª–∏ `inbox-attachments`
   - **Buckets:** –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –±–∞–∫–µ—Ç (`fastprepusaattachments`) –∏–ª–∏ "All buckets"
   - **Permissions:** –ú–∏–Ω–∏–º—É–º –Ω—É–∂–Ω—ã `Read` –∏ `Write` (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å "All Permissions" –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã)

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ:**
   - **Access Key ID** ‚Äî —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ä–∞–∑—É
   - **Secret Access Key** ‚Äî **—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ë–ï–ó–û–ü–ê–°–ù–û** (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Render

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è Access Keys –æ–±–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Render:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Å–µ—Ä–≤–∏—Å –≤ Render Dashboard**
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Environment**
3. **–î–æ–±–∞–≤—å—Ç–µ/–æ–±–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**

```bash
S3_ENDPOINT=https://nyc3.digitaloceanspaces.com
S3_REGION=nyc3
S3_BUCKET=fastprepusaattachments
S3_ACCESS_KEY_ID=DO00TWG4AKFFQB  # –í–∞—à Access Key ID
S3_SECRET_ACCESS_KEY=your_secret_key_here  # –í–∞—à Secret Access Key
```

**–í–∞–∂–Ω–æ:** 
- `S3_ENDPOINT` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ `https://{region}.digitaloceanspaces.com`
- –†–µ–≥–∏–æ–Ω `nyc3` –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –≤–∞—à–µ–≥–æ Spaces Bucket
- Secret Access Key –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—Ç–æ—á–Ω–æ–π –∫–æ–ø–∏–µ–π** –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤

4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–ª—é—á–µ–π

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
1. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —á–µ—Ä–µ–∑ UI
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Render ‚Äî –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ `InvalidAccessKeyId` –∏–ª–∏ `SignatureDoesNotMatch`
3. –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª–µ/–∫–æ–Ω—Ü–µ)

