# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã CORS –∏ Unknown —á–∞—Ç–æ–≤

## ‚úÖ –ü–ª–∞–Ω –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞ –ø–æ CORS - –ü–†–ê–í–ò–õ–¨–ù–´–ô

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å `CORS_ALLOWED_ORIGINS=https://admin.fastprepusa.com` –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Render.

---

## –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è —Å CORS:

### –í –∫–æ–¥–µ (`src/main.ts`):
```typescript
cors: true,  // –†–∞–∑—Ä–µ—à–∞–µ—Ç –í–°–ï origins
```

**–ü—Ä–æ–±–ª–µ–º–∞:** CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–æ (`cors: true`), —á—Ç–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö origins.

---

## üîç –°–≤—è–∑—å —Å –ø—Ä–æ–±–ª–µ–º–æ–π Unknown —á–∞—Ç–æ–≤:

### CORS –ù–ï —Å–≤—è–∑–∞–Ω –Ω–∞–ø—Ä—è–º—É—é —Å Unknown —á–∞—Ç–∞–º–∏:

**Unknown —á–∞—Ç—ã - —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram API –Ω–∞ BACKEND:**
- Frontend ‚Üí Backend (CORS –º–æ–∂–µ—Ç –≤–ª–∏—è—Ç—å)
- Backend ‚Üí Telegram API (CORS –ù–ï –≤–ª–∏—è–µ—Ç)

**–ù–û CORS –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- –ï—Å–ª–∏ CORS –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ, frontend –º–æ–∂–µ—Ç –Ω–µ –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç backend
- –≠—Ç–æ –º–æ–∂–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- –ò–ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—à–∏–±–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–≤–ª–µ–∫–∞—é—Ç –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã

---

## ‚úÖ –ß–¢–û –î–ï–õ–ê–¢–¨:

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å CORS —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞

**–®–∞–≥–∏:**
1. Render Dashboard ‚Üí `fastprep-admin-api` ‚Üí **Environment**
2. –î–æ–±–∞–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é:
   - **Key:** `CORS_ALLOWED_ORIGINS`
   - **Value:** `https://admin.fastprepusa.com`
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### 2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–í `src/main.ts`:**
```typescript
// –ó–∞–º–µ–Ω–∏—Ç—å:
cors: true,

// –ù–∞:
cors: {
  origin: process.env.CORS_ALLOWED_ORIGINS?.split(',') || ['https://admin.fastprepusa.com'],
  credentials: true,
},
```

**–ò–ª–∏ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:**
```typescript
cors: {
  origin: (origin, callback) => {
    const allowedOrigins = process.env.CORS_ALLOWED_ORIGINS?.split(',') || ['https://admin.fastprepusa.com'];
    if (!origin || allowedOrigins.includes(origin)) {
      callback(null, true);
    } else {
      callback(new Error('Not allowed by CORS'));
    }
  },
  credentials: true,
},
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û:

### CORS –∏ Unknown —á–∞—Ç—ã - –†–ê–ó–ù–´–ï –ø—Ä–æ–±–ª–µ–º—ã:

1. **Unknown —á–∞—Ç—ã:**
   - –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç—Å—è –∏–∑ Telegram API –Ω–∞ backend
   - –†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `processIncomingMessage` –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ entity

2. **CORS:**
   - –ü—Ä–æ–±–ª–µ–º–∞: Frontend –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç backend
   - –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `CORS_ALLOWED_ORIGINS`

**–û–±–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å, –Ω–æ –æ–Ω–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã.**

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô:

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å CORS (–ø—Ä–æ—Å—Ç–æ–µ, –±—ã—Å—Ç—Ä–æ–µ)
1. –î–æ–±–∞–≤–∏—Ç—å `CORS_ALLOWED_ORIGINS` –≤ Render Environment
2. –û–±–Ω–æ–≤–∏—Ç—å `main.ts` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ CORS —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å Unknown —á–∞—Ç—ã (—Ç—Ä–µ–±—É–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
1. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `telegram-events.controller.ts` –∏ `telegram.service.ts`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ `message` –æ—Ç Telegram API
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª–∏ –∫–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è entity
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:

**–°–æ–≥–ª–∞—Å–µ–Ω —Å –ø–ª–∞–Ω–æ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–∞ –ø–æ CORS:**
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ origins
- –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ, —á–µ–º `cors: true`

**–ù–û:** –≠—Ç–æ –Ω–µ —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É Unknown —á–∞—Ç–æ–≤. –î–ª—è Unknown —á–∞—Ç–æ–≤ –Ω—É–∂–Ω–æ:
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `processIncomingMessage`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ—á–µ–º—É –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–∞—é—Ç—Å—è –∏–∑ Telegram API
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ entity

---

## üîß –ß–¢–û –°–î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–°:

1. **–î–æ–±–∞–≤–∏—Ç—å `CORS_ALLOWED_ORIGINS` –≤ Render** (–∫–∞–∫ –ø—Ä–µ–¥–ª–æ–∂–∏–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä)
2. **–û–±–Ω–æ–≤–∏—Ç—å `main.ts`** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
3. **–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É Unknown —á–∞—Ç–æ–≤** (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `processIncomingMessage`)

–û–±–µ –ø—Ä–æ–±–ª–µ–º—ã –≤–∞–∂–Ω—ã, –Ω–æ –æ–Ω–∏ —Ä–µ—à–∞—é—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

